name = "rpg-social-worker"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# D1 Database binding
# Uncomment and fill in database_id after creating with: wrangler d1 create rpg-social-media-production
# [[d1_databases]]
# binding = "DB"
# database_name = "rpg-social-media-production"
# database_id = "YOUR_DATABASE_ID_HERE"
[[d1_databases]]
binding = "DB"
database_name = "rpg-social-media-production"
database_id = "cf50ebd0-04f0-41cc-910b-e6f1fa3facec"

# R2 Storage binding for media uploads (level 3+)
[[r2_buckets]]
binding = "MEDIA_BUCKET"
bucket_name = "rpg-media-uploads-production"

# KV Namespace for rate limiting
# Uncomment and fill in id after creating with: wrangler kv namespace create RATE_LIMIT_KV
# [[kv_namespaces]]
# binding = "RATE_LIMIT_KV"
# id = "YOUR_KV_ID_HERE"
[[kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "8e59389f021b4ea48f3e71333b1ac39e"

# Environment variables (set via wrangler secret put or dashboard)
[vars]
ENVIRONMENT = "production"
PUBLIC_URL = "https://rpg.apogeeforge.com"  # Required: Your production domain URL
MODERATION_ENABLED = "true"  # Enable content moderation (set to "false" to disable)
FROM_EMAIL = "noreply@rpg.apogeeforge.com"  # Sender address for transactional emails

# Observability configuration
[observability.logs]
enabled = true
invocation_logs = true

# Secrets (set via: wrangler secret put <NAME>)
# - JWT_SECRET (required) - Set with: wrangler secret put JWT_SECRET
#   This is REQUIRED for authentication. Generate a strong secret with: openssl rand -base64 32
#
# - OPENAI_API_KEY (optional) - Set with: wrangler secret put OPENAI_API_KEY
#   Required for text moderation. Get from: https://platform.openai.com/api-keys
#
# - GOOGLE_VISION_API_KEY (optional) - Set with: wrangler secret put GOOGLE_VISION_API_KEY
#   Required for image moderation. Get from: https://console.cloud.google.com/apis/credentials
#
# - RESEND_API_KEY (optional) - Set with: wrangler secret put RESEND_API_KEY
#   Required for sending verification and password reset emails. Get from: https://resend.com/api-keys
#   Without this key, email content is logged to wrangler dev console instead of sent.

# Production environment (uses same bindings as default)
[env.production]
name = "rpg-social-worker-production"
routes = [
  { pattern = "rpg.apogeeforge.com/api/*", zone_name = "apogeeforge.com" }
]

[[env.production.d1_databases]]
binding = "DB"
database_name = "rpg-social-media-production"
database_id = "cf50ebd0-04f0-41cc-910b-e6f1fa3facec"

[[env.production.r2_buckets]]
binding = "MEDIA_BUCKET"
bucket_name = "rpg-media-uploads-production"

[[env.production.kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "8e59389f021b4ea48f3e71333b1ac39e"

[env.production.vars]
ENVIRONMENT = "production"
MODERATION_ENABLED = "true"
FROM_EMAIL = "noreply@rpg.apogeeforge.com"

[env.production.observability.logs]
enabled = true
invocation_logs = true
